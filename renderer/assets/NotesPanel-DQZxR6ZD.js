const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./NoteEditor-D74SpOm7.js","./index-B76BCRfw.js","./index-Cf0EQwEv.css","./syntax-CcjPonrs.js","./index-BJ7vWnWU.js","./NoteEditor-3hfWUequ.css"])))=>i.map(i=>d[i]);
import{r as n,n as C,j as t,h as H,L as ee,P as te,b as se,F as ne,T as ae,_ as le}from"./index-B76BCRfw.js";import{S as M}from"./save-BVuUmIJc.js";const U=()=>typeof window<"u"?window.electronAPI:void 0,re=async s=>{if(!s)return[];const c=U();return c!=null&&c.getNotes?c.getNotes(s):[]},J=async(s,c)=>{if(!s||!c)return null;const l=U();return l!=null&&l.saveNote?l.saveNote(s,c):c},oe=async(s,c)=>{if(!s||!c)return;const l=U();if(l!=null&&l.deleteNote){await l.deleteNote(s,c);return}},ie=n.lazy(()=>le(()=>import("./NoteEditor-D74SpOm7.js").then(s=>s.K),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url)),j=(...s)=>s.filter(Boolean).join(" "),ce=s=>{const c=new Date(s);if(Number.isNaN(c.getTime()))return"Just now";const l=Date.now()-c.getTime(),d=Math.floor(l/6e4);if(d<1)return"Just now";if(d<60)return`${d} mins ago`;const u=Math.floor(d/60);return u<24?`${u} hours ago`:`${Math.floor(u/24)} days ago`};function de(s,c){const l=n.useRef(s),d=n.useRef(null);n.useEffect(()=>{l.current=s},[s]);const u=n.useCallback(()=>{d.current&&(window.clearTimeout(d.current),d.current=null)},[]),x=n.useCallback((...g)=>{u(),d.current=window.setTimeout(()=>l.current(...g),c)},[u,c]);return n.useEffect(()=>u,[u]),{run:x,cancel:u}}function ue(s,c=!0){n.useEffect(()=>{if(!c)return;const l=d=>{const u=[d.ctrlKey||d.metaKey?"mod":"",d.shiftKey?"shift":"",d.altKey?"alt":"",d.key.toLowerCase()].filter(Boolean).join("+"),x=s[u];x&&x(d)};return window.addEventListener("keydown",l),()=>window.removeEventListener("keydown",l)},[s,c])}const me=({activeProjectId:s,activeProject:c})=>{const l=n.useMemo(()=>{var e;return typeof window<"u"&&!!((e=window.electronAPI)!=null&&e.getNotes)},[]),[d,u]=n.useState([]),[x,g]=n.useState(null),[o,V]=n.useState(null),[z,_]=n.useState(!1),[$,m]=n.useState(null),[S,W]=n.useState(""),q=n.useRef(null),E=n.useRef(null),[k,F]=n.useState(!1),[w,K]=n.useState(!1),N=n.useRef(!1),v=n.useRef(0),G=n.useMemo(()=>`${s||"none"}-${x||"none"}`,[s,x]),L=n.useMemo(()=>[...d].sort((e,r)=>new Date(r.updatedAt).getTime()-new Date(e.updatedAt).getTime()),[d]),D=n.useMemo(()=>{const e=S.trim().toLowerCase();return e?L.filter(r=>(r.title||"").toLowerCase().includes(e)||(r.content||"").toLowerCase().includes(e)):L},[L,S]),f=n.useCallback((e,r=!1)=>{V(e),K(r)},[]),X=n.useCallback(e=>{g(e.id),N.current=!0,f(e,!1),m(null)},[f]),y=n.useCallback(async()=>{if(!(!s||!l)){_(!0),m(null);try{const e=await re(s);u(e);const a=(x?e.find(i=>i.id===x):null)||e[0]||null;a?(g(a.id),N.current=!0,f(a,!1)):(g(null),f(null,!1))}catch(e){m((e==null?void 0:e.message)||"Unable to load notes."),C((e==null?void 0:e.message)||"Unable to load notes.")}finally{_(!1)}}},[s,l,x,f]);n.useEffect(()=>{l&&y()},[l,s,y]);const B=n.useCallback(async()=>{if(!s)return;if(!l){m("Launch the Electron app to store notes in SQLite.");return}const e=new Date().toISOString(),r={id:`note-${Date.now()}`,projectId:s,title:"New Note",content:"",createdAt:e,updatedAt:e};u(a=>[r,...a]),g(r.id),N.current=!0,f(r,!0),m(null);try{const a=await J(s,r);a&&(u(i=>[a,...i.filter(p=>p.id!==r.id&&p.id!==a.id)]),g(a.id),N.current=!0,f(a,!1))}catch(a){m((a==null?void 0:a.message)||"Unable to create note."),C((a==null?void 0:a.message)||"Unable to create note.")}},[s,l,f]),O=n.useCallback(async e=>{const r=d.find(i=>i.id===e);if(!r)return;if(!l){m("Launch the Electron app to manage notes in SQLite.");return}if(window.confirm(`Delete "${r.title}"?`)){if(m(null),u(i=>i.filter(p=>p.id!==e)),x===e){const i=d.filter(p=>p.id!==e)[0]||null;g((i==null?void 0:i.id)||null),N.current=!0,f(i,!1)}try{await oe(s,e)}catch(i){m((i==null?void 0:i.message)||"Unable to delete note."),C((i==null?void 0:i.message)||"Unable to delete note."),y()}}},[x,s,l,d,y,f]),Y=n.useCallback(async()=>{var r;if(!l)throw new Error("Launch the Electron app to upload assets.");const e=await((r=window.electronAPI)==null?void 0:r.selectMedia("image"));if(!(e!=null&&e.url))throw new Error("No file selected.");return e.url},[l]),A=n.useCallback(async e=>{if(!s||!l)return;const r=++v.current;F(!0),m(null);try{const a=await J(s,{...e,projectId:s,updatedAt:new Date().toISOString()});if(r!==v.current)return;a?(u(i=>{const p=i.filter(b=>b.id!==a.id);return[a,...p]}),f(a,!1)):K(!1)}catch(a){if(r!==v.current)return;m((a==null?void 0:a.message)||"Unable to save note."),C((a==null?void 0:a.message)||"Unable to save note.")}finally{r===v.current&&F(!1)}},[s,l,f]),R=de(e=>A(e),700);n.useEffect(()=>{if(!(!o||!s||!l)){if(N.current){N.current=!1;return}if(w)return R.run(o),()=>{R.cancel()}}},[o,s,l,w,R]),n.useEffect(()=>{if(!E.current)return;const e=E.current,r=()=>{e.querySelectorAll(".cm-editor").forEach(p=>{if(p.querySelector(".code-copy-button"))return;const b=document.createElement("button");b.className="code-copy-button",b.type="button",b.textContent="Copy",b.addEventListener("click",async()=>{const T=p.querySelector(".cm-content"),P=(T==null?void 0:T.textContent)||"";try{await navigator.clipboard.writeText(P),b.textContent="Copied",window.setTimeout(()=>{b.textContent="Copy"},1200)}catch{b.textContent="Failed",window.setTimeout(()=>{b.textContent="Copy"},1200)}}),p.appendChild(b)})};r();const a=new MutationObserver(r);return a.observe(e,{childList:!0,subtree:!0}),()=>a.disconnect()},[o==null?void 0:o.id]),ue({"mod+s":e=>{e.preventDefault(),o&&w&&A(o)},"mod+n":e=>{e.preventDefault(),B()},"mod+f":e=>{var r;e.preventDefault(),(r=q.current)==null||r.focus()},delete:e=>{var a,i;const r=(i=(a=e.target)==null?void 0:a.tagName)==null?void 0:i.toLowerCase();r==="input"||r==="textarea"||o&&O(o.id)},escape:()=>{m(null)}},!0);const h=l&&!!s,Z=n.useCallback(e=>{o&&f({...o,title:e},!0)},[o,f]),I=n.useCallback(e=>{o&&f({...o,content:e},!0)},[o,f]),Q=n.useMemo(()=>h?k?{label:"Saving…",icon:t.jsx(ee,{size:14,className:"animate-spin text-indigo-600"})}:w?{label:"Unsaved",icon:t.jsx(M,{size:14,className:"text-slate-400"})}:{label:"Saved",icon:t.jsx(M,{size:14,className:"text-emerald-500"})}:{label:"Offline",icon:t.jsx(H,{size:14,className:"text-slate-400"})},[h,w,k]);return t.jsxs("div",{className:"flex flex-col lg:flex-row min-h-[60vh] lg:h-[calc(100vh-220px)] bg-white rounded-[2.5rem] border border-slate-200 overflow-hidden shadow-sm",children:[t.jsxs("aside",{className:"w-full lg:w-80 lg:border-r border-slate-100 bg-white/80 p-4 sm:p-6 flex flex-col",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-[9px] font-black text-slate-400 uppercase tracking-[0.3em]",children:"Project Notes"}),t.jsx("h3",{className:"text-lg font-black text-slate-800 tracking-tight",children:(c==null?void 0:c.name)||"Notes"})]}),t.jsx("button",{onClick:B,className:j("w-9 h-9 rounded-xl flex items-center justify-center shadow-lg shadow-indigo-100 transition-all",h?"bg-indigo-600 text-white hover:scale-105 active:scale-95":"bg-slate-200 text-slate-400 cursor-not-allowed"),title:"New note (Ctrl/Cmd+N)",disabled:!h,children:t.jsx(te,{size:16})})]}),t.jsxs("div",{className:"relative mb-4",children:[t.jsx(se,{size:14,className:"absolute left-3.5 top-1/2 -translate-y-1/2 text-slate-300"}),t.jsx("input",{ref:q,type:"text",placeholder:"Search notes... (Ctrl/Cmd+F)",value:S,onChange:e=>W(e.target.value),className:"w-full pl-9 pr-3 py-2.5 bg-slate-50 border border-slate-100 rounded-2xl text-[10px] font-black focus:ring-4 focus:ring-indigo-500/5 focus:border-indigo-100 outline-none uppercase tracking-widest placeholder:text-slate-300"})]}),t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("p",{className:"text-[9px] font-black uppercase tracking-[0.3em] text-slate-400",children:z?"Loading…":`${D.length} notes`}),t.jsx("button",{onClick:y,className:j("text-[9px] font-black uppercase tracking-[0.3em] px-3 py-1.5 rounded-xl border transition-all",h?"border-slate-200 text-slate-500 hover:bg-slate-50":"border-slate-100 text-slate-300 cursor-not-allowed"),disabled:!h,title:"Refresh",children:"Refresh"})]}),t.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar space-y-2 pr-1",children:z?t.jsx("div",{className:"text-[9px] font-black uppercase tracking-[0.3em] text-slate-400",children:"Loading notes..."}):D.length?D.map(e=>t.jsx("button",{onClick:()=>X(e),className:j("w-full text-left p-4 rounded-2xl border transition-all group",x===e.id?"border-indigo-200 bg-indigo-50/60":"border-slate-100 hover:border-slate-200 hover:bg-slate-50"),children:t.jsxs("div",{className:"flex items-start justify-between gap-3",children:[t.jsxs("div",{className:"min-w-0",children:[t.jsx("p",{className:"text-[11px] font-black text-slate-800 truncate",children:e.title}),t.jsx("p",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest mt-1",children:ce(e.updatedAt)})]}),t.jsx(ne,{size:14,className:"text-slate-300 group-hover:text-slate-400 transition-colors"})]})},e.id)):t.jsx("div",{className:"text-[9px] font-black uppercase tracking-[0.3em] text-slate-400",children:"No notes yet"})})]}),t.jsxs("section",{className:"flex-1 flex flex-col min-h-[50vh]",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 px-4 sm:px-8 py-4 sm:py-6 border-b border-slate-100",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-[9px] font-black text-indigo-600 uppercase tracking-[0.4em]",children:"Markdown Workspace"}),t.jsx("h2",{className:"text-2xl font-black text-slate-800 tracking-tight",children:(o==null?void 0:o.title)||"Select a note"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-2xl border border-slate-100 bg-white shadow-sm",children:[Q.icon,t.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.3em] text-slate-500",children:Q.label})]}),o&&t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:()=>o&&w&&A(o),disabled:!h||!w||k,className:j("px-3 py-2 text-[9px] font-black uppercase tracking-widest rounded-xl border transition-all",!h||!w||k?"border-slate-100 text-slate-300 bg-slate-50 cursor-not-allowed":"border-indigo-200 text-indigo-700 bg-indigo-50 hover:bg-indigo-100"),title:"Save now (Ctrl/Cmd+S)",children:[t.jsx(M,{size:12,className:"inline mr-1"}),"Save"]}),t.jsxs("button",{onClick:()=>O(o.id),className:"px-3 py-2 text-[9px] font-black uppercase tracking-widest rounded-xl bg-rose-50 text-rose-500 hover:bg-rose-100 transition-all",title:"Delete (Del)",disabled:!h,children:[t.jsx(ae,{size:12,className:"inline mr-1"})," Delete"]})]})]})]}),(!l||$)&&t.jsxs("div",{className:"mx-4 sm:mx-8 mt-4 bg-rose-50/80 border border-rose-100 text-rose-600 text-[10px] font-black uppercase tracking-[0.25em] px-6 py-3 rounded-2xl flex items-center gap-2",children:[t.jsx(H,{size:14}),t.jsx("span",{children:l?$:"Launch the Electron app to use Notes with SQLite."})]}),t.jsx("div",{className:"flex-1 overflow-y-auto p-4 sm:p-8 bg-slate-50/40 custom-scrollbar",children:o?t.jsxs("div",{className:"w-full max-w-none space-y-6",children:[t.jsx("input",{type:"text",value:o.title,onChange:e=>Z(e.target.value),className:"w-full text-2xl sm:text-3xl font-black text-slate-900 tracking-tight p-3 rounded-2xl border border-slate-100 bg-white shadow-sm outline-none focus:ring-4 focus:ring-indigo-500/10",placeholder:"Note title..."}),t.jsx("div",{ref:E,className:"bg-white rounded-2xl border border-slate-100 shadow-sm",children:t.jsx(n.Suspense,{fallback:t.jsx("div",{className:"p-6 text-[10px] font-black uppercase tracking-[0.3em] text-slate-400",children:"Loading editor..."}),children:t.jsx(ie,{editorKey:G,markdown:o.content||"",onChange:e=>I(e),onUploadImage:Y})})}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-[9px] font-black uppercase tracking-[0.3em] text-slate-400",children:[t.jsx("span",{className:"px-3 py-2 rounded-2xl border border-slate-100 bg-white",children:"Ctrl/Cmd+S save"}),t.jsx("span",{className:"px-3 py-2 rounded-2xl border border-slate-100 bg-white",children:"Ctrl/Cmd+N new"}),t.jsx("span",{className:"px-3 py-2 rounded-2xl border border-slate-100 bg-white",children:"Ctrl/Cmd+F search"}),t.jsx("span",{className:"px-3 py-2 rounded-2xl border border-slate-100 bg-white",children:"Del delete"})]})]}):t.jsx("div",{className:"h-full flex items-center justify-center text-[10px] font-black uppercase tracking-[0.3em] text-slate-400",children:"Select or create a note"})})]})]})};export{me as default};
