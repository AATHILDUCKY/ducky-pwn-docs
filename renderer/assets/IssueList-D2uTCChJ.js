import{c as b,j as e,r as i,D as he,P as ue,X as T,T as le,n as M,b as ge,d as be,U as fe,s as je,e as ve}from"./index-DDXeGDIl.js";import{S as ie,T as Ne,B as f,E as ye,a as we,M as V}from"./Elements-BVXU2gJE.js";import{f as ke,S as Se,p as ee,d as Fe}from"./issueService-DyZN3Vjk.js";import{S as Ce}from"./save-BnYu6U7j.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],ze=b("arrow-down",Me);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],Ie=b("arrow-up",De);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]],Ee=b("bold",$e);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],Ae=b("book-open",_e);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],Ve=b("circle-plus",Oe);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Le=b("circle-play",Te);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=[["path",{d:"m16 18 6-6-6-6",key:"eg8j8"}],["path",{d:"m8 6-6 6 6 6",key:"ppft3o"}]],Re=b("code",Pe);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],ne=b("image",He);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]],qe=b("italic",Be);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],Ye=b("link",Xe);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],Qe=b("maximize-2",Je);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=[["path",{d:"M5 12h14",key:"1ays0h"}]],Ze=b("minus",Ue);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],se=b("pen",Ge);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],re=b("video",We),_=({type:t,url:o,alt:m})=>{const[g,j]=i.useState(!1),[x,u]=i.useState(1),[v,d]=i.useState({x:0,y:0}),[l,s]=i.useState(!1),[n,r]=i.useState({x:0,y:0}),p=h=>{h.preventDefault();const y=document.createElement("a");y.href=o,y.download=m||`vanguard-evidence-${Date.now()}`,document.body.appendChild(y),y.click(),document.body.removeChild(y)},N=()=>{u(1),d({x:0,y:0}),j(!0)},w=()=>j(!1);return e.jsxs("div",{className:"group relative my-8 rounded-lg overflow-hidden border border-slate-200 bg-slate-50 transition-all hover:shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-3 bg-white/90 backdrop-blur-sm border-b border-slate-100 absolute top-0 left-0 right-0 z-10 opacity-0 group-hover:opacity-100 transition-all",children:[e.jsxs("span",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] flex items-center gap-2",children:[t==="image"?e.jsx(ne,{size:12}):e.jsx(re,{size:12}),"Secured Evidence"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:N,className:"p-2 bg-white text-slate-500 rounded-md hover:bg-slate-100 transition-all shadow-sm border border-slate-200",title:"Open large view",children:e.jsx(Qe,{size:12})}),e.jsxs("button",{onClick:p,className:"p-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-all shadow-lg flex items-center gap-2 text-[9px] font-black uppercase tracking-widest",children:[e.jsx(he,{size:14})," Download"]})]})]}),t==="image"?e.jsx("div",{className:"w-full bg-white p-3 flex items-center justify-center",children:e.jsx("img",{src:o,alt:m,className:"w-full h-auto object-contain max-h-[560px]"})}):e.jsxs("div",{className:"w-full bg-white p-3 flex items-center justify-center relative",children:[e.jsx("video",{src:o,controls:!0,className:"w-full max-h-[560px] object-contain bg-black"}),e.jsx(Le,{size:48,className:"text-white opacity-40 absolute pointer-events-none"})]}),m&&e.jsx("div",{className:"px-6 py-4 bg-white border-t border-slate-50 text-[12px] font-semibold text-slate-500 italic leading-relaxed",children:m}),g&&e.jsxs("div",{className:"fixed inset-0 z-[600] bg-slate-900/80 backdrop-blur-sm flex items-center justify-center p-6",children:[e.jsx("div",{className:"absolute inset-0",onClick:w}),e.jsxs("div",{className:"relative z-10 w-full max-w-6xl max-h-[90vh] bg-black/40 border border-white/10 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-black/70 text-white",children:[e.jsxs("div",{className:"text-[10px] font-black uppercase tracking-widest",children:[t==="image"?"Image":"Video"," Viewer"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t==="image"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>u(h=>Math.max(.5,+(h-.25).toFixed(2))),className:"p-1.5 rounded-md bg-white/10 hover:bg-white/20",title:"Zoom out",children:e.jsx(Ze,{size:12})}),e.jsx("button",{onClick:()=>u(h=>Math.min(3,+(h+.25).toFixed(2))),className:"p-1.5 rounded-md bg-white/10 hover:bg-white/20",title:"Zoom in",children:e.jsx(ue,{size:12})})]}),e.jsx("button",{onClick:w,className:"p-1.5 rounded-md bg-white/10 hover:bg-white/20",title:"Close",children:e.jsx(T,{size:12})})]})]}),e.jsx("div",{className:"flex items-center justify-center bg-black max-h-[80vh] overflow-hidden",onMouseMove:h=>{if(!l||x<=1)return;const y=h.clientX-n.x,S=h.clientY-n.y;d(z=>({x:z.x+y,y:z.y+S})),r({x:h.clientX,y:h.clientY})},onMouseUp:()=>s(!1),onMouseLeave:()=>s(!1),children:t==="image"?e.jsx("img",{src:o,alt:m,className:`max-h-[80vh] object-contain ${x>1?"cursor-grab active:cursor-grabbing select-none":""}`,style:{transform:`translate(${v.x}px, ${v.y}px) scale(${x})`,transformOrigin:"center center"},onMouseDown:h=>{x<=1||(s(!0),r({x:h.clientX,y:h.clientY}))}}):e.jsx("video",{src:o,controls:!0,className:"w-full max-h-[80vh] object-contain bg-black"})})]})]})]})},A=({content:t})=>{if(!t)return null;const o=t.split(/(\[image:.*?\]|\[video:.*?\]|\[image\|.*?\]|\[video\|.*?\])/g);return e.jsx("div",{className:"prose-report space-y-1",children:o.map((m,g)=>{const j=m.match(/\[image\|(.*?)\|(.*?)\]/),x=m.match(/\[video\|(.*?)\|(.*?)\]/),u=m.match(/\[image:(.*?):?(.*?)\]/),v=m.match(/\[video:(.*?):?(.*?)\]/);return j?e.jsx(_,{type:"image",url:j[1],alt:j[2]},g):x?e.jsx(_,{type:"video",url:x[1],alt:x[2]},g):u?e.jsx(_,{type:"image",url:u[1],alt:u[2]},g):v?e.jsx(_,{type:"video",url:v[1],alt:v[2]},g):m.split(`
`).map((d,l)=>{let s=d.replace(/\*\*(.*?)\*\*/g,'<strong class="font-bold text-slate-900">$1</strong>');return s=s.replace(/`(.*?)`/g,'<code class="bg-slate-100 px-1.5 py-0.5 rounded font-mono text-indigo-600 text-[0.9em]">$1</code>'),d.trim().startsWith("- ")?e.jsx("li",{className:"text-[15px] text-slate-800 leading-relaxed ml-4 my-1",dangerouslySetInnerHTML:{__html:s.trim().substring(2)}},`${g}-${l}`):s.trim()?e.jsx("p",{className:"text-[15px] text-slate-800 leading-relaxed my-2",dangerouslySetInnerHTML:{__html:s}},`${g}-${l}`):null})})})},te=({finding:t})=>e.jsx("div",{className:"max-w-5xl mx-auto bg-white rounded-none overflow-hidden min-h-screen",children:e.jsxs("div",{className:"p-8 lg:p-12 space-y-16",children:[e.jsxs("div",{className:"space-y-12",children:[e.jsxs("div",{className:"space-y-5",children:[e.jsx("h4",{className:"text-[10px] font-black text-indigo-600 uppercase tracking-[0.3em] border-b border-indigo-50 pb-3",children:"Security Finding Intelligence"}),e.jsx("h1",{className:"text-4xl font-black text-slate-900 tracking-tighter leading-tight",children:t.title})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-x-12 gap-y-10",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest leading-none",children:"CVSS Base"}),e.jsx("p",{className:`text-2xl font-black ${parseFloat(t.cvssScore)>=7?"text-rose-600":"text-indigo-600"} tabular-nums`,children:t.cvssScore})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest leading-none",children:"Severity"}),e.jsx(ie,{severity:t.severity})]}),e.jsxs("div",{className:"space-y-2 lg:col-span-1",children:[e.jsx("h4",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest leading-none",children:"Vector String"}),e.jsx("p",{className:"text-[11px] font-mono text-slate-500 break-all leading-relaxed",children:t.cvssVector})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest leading-none",children:"Security Domain"}),e.jsx("p",{className:"text-sm font-bold text-slate-800",children:t.type})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest leading-none",children:"Affected Surface"}),e.jsx("p",{className:"text-sm font-bold text-slate-800",children:t.affected||"General Scope"})]})]})]}),e.jsxs("section",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-2xl bg-indigo-50 flex items-center justify-center text-indigo-600 shadow-sm shadow-indigo-100",children:e.jsx(Ae,{size:18})}),e.jsx("h3",{className:"text-lg font-black text-slate-900 uppercase tracking-widest",children:"Description"})]}),e.jsx("div",{className:"ml-5 border-l-2 border-slate-100 pl-10",children:e.jsx(A,{content:t.description})})]}),t.customFields&&t.customFields.length>0&&e.jsx("div",{className:"pt-16 border-t border-slate-50 space-y-16 pb-24",children:t.customFields.map(o=>e.jsxs("section",{className:"space-y-4 ml-5 border-l-2 border-slate-100 pl-10",children:[e.jsx("h4",{className:"text-[10px] font-black text-indigo-600 uppercase tracking-[0.2em] leading-none",children:o.label||"Tactical Context"}),e.jsx("div",{className:"text-[15px] text-slate-800",children:e.jsx(A,{content:o.value})})]},o.id))})]})}),ae=({onUpload:t})=>e.jsxs("div",{className:"flex items-center gap-0.5 bg-white border border-slate-200 rounded-xl p-1 shadow-2xl shadow-slate-200/50 z-[50] animate-in fade-in slide-in-from-bottom-1 duration-200",children:[e.jsx("button",{className:"p-1.5 hover:bg-slate-100 rounded-lg text-slate-600",children:e.jsx(Ee,{size:13})}),e.jsx("button",{className:"p-1.5 hover:bg-slate-100 rounded-lg text-slate-600",children:e.jsx(qe,{size:13})}),e.jsx("button",{className:"p-1.5 hover:bg-slate-100 rounded-lg text-slate-600",children:e.jsx(Re,{size:13})}),e.jsx("button",{className:"p-1.5 hover:bg-slate-100 rounded-lg text-slate-600",children:e.jsx(Ye,{size:13})}),e.jsx("button",{className:"p-1.5 hover:bg-slate-100 rounded-lg text-slate-600",children:e.jsx(Ne,{size:13})}),e.jsx("div",{className:"w-px h-4 bg-slate-200 mx-1.5"}),e.jsx("button",{onClick:()=>t("image"),className:"p-1.5 hover:bg-indigo-50 hover:text-indigo-600 rounded-lg text-slate-600 transition-colors",children:e.jsx(ne,{size:13})}),e.jsx("button",{onClick:()=>t("video"),className:"p-1.5 hover:bg-indigo-50 hover:text-indigo-600 rounded-lg text-slate-600 transition-colors",children:e.jsx(re,{size:13})})]}),Ke=({workingCopy:t,onUpdate:o,onOpenUpload:m})=>{const[g,j]=i.useState(null),x=(s,n)=>o({...t,[s]:n}),u=(s,n,r)=>{const p=t.customFields.map(N=>N.id===s?{...N,[n]:r}:N);o({...t,customFields:d(p)})},v=s=>/\[(image|video)\|/.test(s||""),d=s=>{const n=[],r=[];return s.forEach(p=>(v(p.value)?r:n).push(p)),[...n,...r]},l=(s,n)=>{const r=[...t.customFields],p=n==="up"?s-1:s+1;p<0||p>=r.length||([r[s],r[p]]=[r[p],r[s]],o({...t,customFields:d(r)}))};return e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsx("div",{className:"flex-1 overflow-y-auto bg-white border-r border-slate-100 p-8 lg:p-14 relative custom-scrollbar",children:e.jsxs("div",{className:"max-w-3xl mx-auto space-y-14",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black text-indigo-600 uppercase tracking-[0.2em] px-1",children:"Finding Identity"}),e.jsx("input",{type:"text",value:t.title,onChange:s=>x("title",s.target.value),className:"w-full text-3xl font-black text-slate-900 tracking-tighter p-1 border-none outline-none focus:ring-0 placeholder:text-slate-100 bg-transparent",placeholder:"Finding Title..."})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-10 border-y border-slate-50 py-12",children:[{id:"severity",label:"Severity"},{id:"state",label:"Status"},{id:"cvssScore",label:"CVSS Score"},{id:"cvssVector",label:"CVSS Vector"},{id:"type",label:"Domain"},{id:"affected",label:"Affected Asset"}].map(s=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest px-1",children:s.label}),s.id==="type"?e.jsxs("select",{value:t.type,onChange:n=>x("type",n.target.value),className:"w-full bg-slate-50 border border-slate-100 rounded-2xl px-5 py-4 text-sm font-bold text-slate-900 outline-none",children:[e.jsx("option",{value:"Internal",children:"Internal"}),e.jsx("option",{value:"External",children:"External"})]}):s.id==="severity"?e.jsxs("select",{value:t.severity,onChange:n=>x("severity",n.target.value),className:"w-full bg-slate-50 border border-slate-100 rounded-2xl px-5 py-4 text-sm font-bold text-slate-900 outline-none",children:[e.jsx("option",{value:"Critical",children:"Critical"}),e.jsx("option",{value:"High",children:"High"}),e.jsx("option",{value:"Medium",children:"Medium"}),e.jsx("option",{value:"Low",children:"Low"}),e.jsx("option",{value:"Info",children:"Info"})]}):s.id==="state"?e.jsxs("select",{value:t.state,onChange:n=>x("state",n.target.value),className:"w-full bg-slate-50 border border-slate-100 rounded-2xl px-5 py-4 text-sm font-bold text-slate-900 outline-none",children:[e.jsx("option",{value:"Open",children:"Open"}),e.jsx("option",{value:"In Progress",children:"In Progress"}),e.jsx("option",{value:"Fixed",children:"Fixed"}),e.jsx("option",{value:"Draft",children:"Draft"}),e.jsx("option",{value:"Published",children:"Published"}),e.jsx("option",{value:"QA",children:"QA"}),e.jsx("option",{value:"Closed",children:"Closed"})]}):e.jsx("input",{type:"text",value:t[s.id],onChange:n=>x(s.id,n.target.value),className:"w-full bg-slate-50 border border-slate-100 rounded-2xl px-5 py-4 text-sm font-black text-slate-900 focus:bg-white transition-all shadow-sm outline-none",placeholder:`Enter ${s.label}...`})]},s.id))}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-slate-50 pb-2.5",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:"Description"}),g==="description"&&e.jsx(ae,{onUpload:s=>m(s,"description")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>m("image","description"),className:"px-3 py-2 text-[9px] font-black uppercase tracking-widest rounded-xl bg-slate-100 text-slate-500 hover:bg-indigo-50 hover:text-indigo-600 transition-all",children:"Insert Image"}),e.jsx("button",{type:"button",onClick:()=>m("video","description"),className:"px-3 py-2 text-[9px] font-black uppercase tracking-widest rounded-xl bg-slate-100 text-slate-500 hover:bg-indigo-50 hover:text-indigo-600 transition-all",children:"Insert Video"})]}),e.jsx("textarea",{value:t.description,onFocus:()=>j("description"),onChange:s=>x("description",s.target.value),className:"w-full min-h-[400px] text-[16px] text-slate-800 leading-relaxed p-1 border-none outline-none focus:ring-0 placeholder:text-slate-100 bg-transparent resize-none font-medium",placeholder:"Detail the vulnerability analysis..."})]}),e.jsxs("div",{className:"space-y-10 pt-12 border-t border-slate-50 pb-32",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest leading-none",children:"Tactical Intelligence Fields"}),e.jsx("p",{className:"text-[9px] text-slate-400 font-bold uppercase tracking-widest mt-2",children:"These will appear at the bottom of the final report"})]}),e.jsxs("button",{onClick:()=>o({...t,customFields:d([...t.customFields,{id:`cf-${Date.now()}`,label:"New Attribute",value:""}])}),className:"flex items-center gap-1.5 text-[10px] font-black text-indigo-600 hover:text-indigo-700 uppercase tracking-widest transition-colors bg-indigo-50/50 px-4 py-2 rounded-xl",children:[e.jsx(Ve,{size:14})," Add Tactical Field"]})]}),e.jsx("div",{className:"space-y-6",children:t.customFields.map((s,n)=>e.jsxs("div",{className:"group bg-slate-50/50 border border-slate-100 rounded-3xl p-8 hover:border-indigo-100 hover:bg-white transition-all shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("button",{onClick:()=>l(n,"up"),className:"p-1 text-slate-300 hover:text-indigo-500",children:e.jsx(Ie,{size:12})}),e.jsx("button",{onClick:()=>l(n,"down"),className:"p-1 text-slate-300 hover:text-indigo-500",children:e.jsx(ze,{size:12})})]}),e.jsx("div",{className:"w-1.5 h-6 bg-slate-200 rounded-full mx-1"}),e.jsxs("span",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:["Attribute Segment ",n+1]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[g===s.id&&e.jsx(ae,{onUpload:r=>m(r,s.id)}),e.jsx("button",{onClick:()=>o({...t,customFields:t.customFields.filter(r=>r.id!==s.id)}),className:"p-2 text-slate-300 hover:text-rose-500 transition-all opacity-0 group-hover:opacity-100 ml-2",children:e.jsx(le,{size:16})})]})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[9px] font-black text-indigo-600 uppercase tracking-widest",children:"Field Heading"}),e.jsx("input",{type:"text",value:s.label,onChange:r=>u(s.id,"label",r.target.value),className:"w-full bg-transparent border-none text-sm font-black text-slate-800 uppercase tracking-[0.2em] outline-none focus:text-indigo-700 placeholder:text-slate-200",placeholder:"Segment Heading..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest",children:"Field Value (Markdown)"}),e.jsx("textarea",{value:s.value,onFocus:()=>j(s.id),onChange:r=>u(s.id,"value",r.target.value),className:"w-full bg-transparent border-none text-[15px] font-medium text-slate-800 outline-none resize-none min-h-[120px] leading-relaxed",placeholder:"Enter data or instructions..."})]})]})]},s.id))})]})]})}),e.jsx("div",{className:"flex-1 bg-slate-50/50 overflow-y-auto custom-scrollbar p-12 border-l border-slate-100 hidden lg:block",children:e.jsxs("div",{className:"max-w-xl mx-auto space-y-12",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("span",{className:"text-[9px] font-black text-indigo-600 uppercase tracking-[0.4em]",children:"Live Intelligence Preview"}),e.jsx("h2",{className:"text-2xl font-black text-slate-900 tracking-tighter leading-tight",children:t.title||"Draft Findings"})]}),e.jsxs("div",{className:"space-y-16",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest border-b border-indigo-50 pb-2",children:"Description"}),e.jsx(A,{content:t.description})]}),t.customFields.map(s=>e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-[10px] font-black text-indigo-600 uppercase tracking-[0.2em]",children:s.label||"Attribute Segment"}),e.jsx("div",{className:"text-[14px] font-bold text-slate-800",children:e.jsx(A,{content:s.value})})]},s.id))]})]})})]})},ls=({activeProjectId:t,activeProject:o,refreshProjects:m})=>{const[g,j]=i.useState([]),[x,u]=i.useState(null),[v,d]=i.useState("list"),[l,s]=i.useState(null),[n,r]=i.useState(""),[p,N]=i.useState(null),[w,h]=i.useState(null),[y,S]=i.useState("confirm"),[z,O]=i.useState(!1),[ce,D]=i.useState(!1),[I,L]=i.useState(""),[P,R]=i.useState(""),[H,B]=i.useState(""),[q,X]=i.useState("pdf"),[Y,J]=i.useState(!1),[Q,F]=i.useState(null),[U,Z]=i.useState([]),C=i.useCallback(async()=>{if(t)try{const a=await ke(t);j(a||[])}catch(a){console.error("Failed to load issues",a),M("Failed to load issues."),j([])}},[t]);i.useEffect(()=>{C()},[C]);const $=i.useMemo(()=>g,[g]),oe=i.useMemo(()=>$.filter(a=>a.title.toLowerCase().includes(n.toLowerCase())),[$,n]);i.useEffect(()=>{u(null),d("list")},[t]),i.useEffect(()=>{const a=localStorage.getItem("vanguardRecentEmails");if(a)try{const c=JSON.parse(a);Array.isArray(c)&&Z(c.filter(k=>typeof k=="string"))}catch{}},[]),i.useEffect(()=>{if(x){const a=$.find(c=>c.id===x);a&&s(JSON.parse(JSON.stringify(a)))}else s(null),d("list")},[x,$]);const de=async()=>{if(!(!l||!t))try{await ee(t,l),await C(),await m(),u(l.id),d("view")}catch(a){console.error("Unable to persist finding",a),M("Unable to save finding.")}},xe=async(a,c)=>{if(!t)return;const k={...a,state:c,isFixed:c==="Fixed",updatedAt:new Date().toISOString()};await ee(t,k),await C()},me=async()=>{!w||!t||(await Fe(t,w.id),h(null),S("confirm"),await C())},G=async()=>{if(!p||!l)return;const{type:a,targetField:c}=p,k=await ve(a);if(!k){N(null);return}const W=`

[${a}|${k.url}|${k.name}]`,K={id:`ev-${Date.now()}`,type:a,content:k.url,caption:k.name};if(c==="description")s({...l,description:`${l.description||""}${W}`,evidence:[...l.evidence||[],K],updatedAt:new Date().toISOString()});else{const pe=(l.customFields||[]).map(E=>E.id===c?{...E,value:`${E.value||""}${W}`}:E);s({...l,customFields:pe,evidence:[...l.evidence||[],K],updatedAt:new Date().toISOString()})}N(null)};return v==="list"?e.jsxs("div",{className:"space-y-10 animate-in fade-in duration-500 pb-20",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Se,{size:14,className:"text-indigo-600"}),e.jsxs("span",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.3em]",children:[o.client," / ",o.name]})]}),e.jsx("h2",{className:"text-4xl font-black text-slate-800 tracking-tighter leading-none",children:"Findings Hub"}),e.jsx("p",{className:"text-slate-500 text-sm font-medium mt-1",children:"Managed audit vault for discovered intelligence and risks."})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative group",children:[e.jsx(ge,{size:14,className:"absolute left-3.5 top-1/2 -translate-y-1/2 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Search...",value:n,onChange:a=>r(a.target.value),className:"pl-10 pr-4 py-2.5 bg-white border border-slate-200 rounded-xl text-[11px] font-black uppercase tracking-widest outline-none focus:ring-4 focus:ring-indigo-500/5 transition-all shadow-sm"})]}),e.jsx(f,{onClick:()=>{const a={id:`f-${Date.now()}`,title:"Draft Finding",severity:"Info",description:"",customFields:[],cvssScore:"0.0",cvssVector:"CVSS:4.0/...",type:"Internal",state:"Open",affected:"",isFixed:!1,tags:[],solution:"",evidence:[],comments:[],updatedAt:new Date().toISOString()};s(a),u(a.id),d("edit")},children:"New Finding"})]})]}),e.jsx("div",{className:"bg-white rounded-[2.5rem] border border-slate-200 shadow-sm overflow-hidden overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left min-w-[800px]",children:[e.jsx("thead",{className:"bg-slate-50/50 border-b border-slate-100",children:e.jsxs("tr",{className:"text-[10px] uppercase font-black tracking-[0.2em] text-slate-400",children:[e.jsx("th",{className:"px-10 py-6",children:"Intelligence Identity"}),e.jsx("th",{className:"px-6 py-6 text-center",children:"Status"}),e.jsx("th",{className:"px-6 py-6",children:"Severity"}),e.jsx("th",{className:"px-10 py-6 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-50",children:oe.map(a=>e.jsxs("tr",{onClick:()=>{u(a.id),d("view")},className:"group cursor-pointer hover:bg-indigo-50/20 transition-all",children:[e.jsx("td",{className:"px-10 py-6",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[14px] font-black text-slate-800 group-hover:text-indigo-600 transition-colors leading-tight",children:a.title}),e.jsx("span",{className:"text-[9px] text-slate-400 font-bold uppercase tracking-widest mt-1.5",children:a.affected||"General Infrastructure"})]})}),e.jsx("td",{className:"px-6 py-6 text-center",children:e.jsxs("select",{value:a.state,onClick:c=>c.stopPropagation(),onChange:c=>xe(a,c.target.value),className:"text-[9px] font-black uppercase tracking-widest bg-white border border-slate-200 rounded-full px-3 py-1.5 text-slate-500",children:[e.jsx("option",{value:"Open",children:"Open"}),e.jsx("option",{value:"In Progress",children:"In Progress"}),e.jsx("option",{value:"Fixed",children:"Fixed"}),e.jsx("option",{value:"Draft",children:"Draft"}),e.jsx("option",{value:"Published",children:"Published"}),e.jsx("option",{value:"QA",children:"QA"}),e.jsx("option",{value:"Closed",children:"Closed"})]})}),e.jsx("td",{className:"px-6 py-6",children:e.jsx(ie,{severity:a.severity})}),e.jsx("td",{className:"px-10 py-6 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2 opacity-0 group-hover:opacity-100 transition-all",children:[e.jsx("button",{onClick:c=>{c.stopPropagation(),u(a.id),d("edit")},className:"p-2.5 text-slate-400 hover:text-indigo-600 bg-white rounded-xl border border-slate-100 shadow-sm",children:e.jsx(se,{size:14})}),e.jsx("button",{onClick:c=>{c.stopPropagation(),h(a),S("confirm")},className:"p-2.5 text-slate-400 hover:text-rose-500 bg-white rounded-xl border border-slate-100 shadow-sm",children:e.jsx(le,{size:14})})]})})]},a.id))})]})})]}):e.jsxs("div",{className:"fixed inset-0 bg-white z-[200] flex flex-col animate-in slide-in-from-right-4 duration-500 overflow-hidden",children:[e.jsxs("header",{className:"h-16 border-b border-slate-200 px-8 flex items-center justify-between bg-white/95 backdrop-blur-md shrink-0 z-[110]",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>d("list"),className:"p-2 text-slate-500 hover:text-indigo-600 bg-slate-50 rounded-xl transition-all",children:e.jsx(be,{size:20})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] font-black text-indigo-600 uppercase tracking-[0.2em] leading-none",children:"Ducky Docs Dossier"}),e.jsx("span",{className:"text-sm font-bold text-slate-900 mt-1 truncate max-w-[400px]",children:l==null?void 0:l.title})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[v==="view"?e.jsxs(e.Fragment,{children:[e.jsxs(f,{variant:"secondary",onClick:()=>O(!0),children:[e.jsx(ye,{size:16})," Preview Report"]}),e.jsxs(f,{variant:"secondary",onClick:()=>{l&&(R(`Finding Report: ${l.title||"Untitled Finding"}`),X("pdf"),D(!0))},children:[e.jsx(we,{size:14})," Send Mail"]}),e.jsxs(f,{onClick:()=>d("edit"),children:[e.jsx(se,{size:14})," Authoring Canvas"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(f,{variant:"secondary",onClick:()=>d("view"),children:"Discard Draft"}),e.jsxs(f,{onClick:de,children:[e.jsx(Ce,{size:14})," Commit Changes"]})]}),e.jsx("button",{onClick:()=>d("list"),className:"p-2.5 text-slate-400 hover:text-rose-500 transition-colors ml-2",children:e.jsx(T,{size:20})})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden flex bg-white",children:v==="view"?e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar bg-slate-50/30 p-8 lg:p-16",children:e.jsx("div",{className:"print-report-only",children:l&&e.jsx(te,{finding:l})})}):l&&e.jsx(Ke,{workingCopy:l,onUpdate:s,onOpenUpload:(a,c)=>N({type:a,targetField:c})})}),e.jsxs(V,{isOpen:!!p,onClose:()=>N(null),title:`Ingest ${(p==null?void 0:p.type)==="image"?"Image":"Video"}`,children:[e.jsxs("button",{type:"button",onClick:G,className:"w-full border-2 border-dashed border-slate-200 rounded-[2rem] p-12 flex flex-col items-center group hover:bg-slate-50 cursor-pointer transition-all",children:[e.jsx(fe,{size:32,className:"text-indigo-600 mb-5 transition-transform group-hover:scale-110"}),e.jsx("p",{className:"text-sm font-black text-slate-800 uppercase tracking-widest",children:"Select Tactical Evidence"}),e.jsx("p",{className:"text-[10px] text-slate-400 font-bold uppercase tracking-widest mt-2",children:"Maximum file weight: 50MB"})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(f,{variant:"secondary",onClick:()=>N(null),className:"flex-1",children:"Cancel"}),e.jsx(f,{onClick:G,className:"flex-[2]",children:"Sync Asset & Sync"})]})]}),e.jsxs(V,{isOpen:!!w,onClose:()=>{h(null),S("confirm")},title:y==="confirm"?"Confirm Deletion":"Final Confirmation",children:[e.jsx("p",{className:"text-sm text-slate-600 font-semibold",children:y==="confirm"?`Delete "${w==null?void 0:w.title}" from this project?`:"This action is permanent. Proceed with deletion?"}),e.jsxs("div",{className:"flex gap-4 pt-6",children:[e.jsx(f,{variant:"secondary",onClick:()=>{h(null),S("confirm")},className:"flex-1",children:"Cancel"}),y==="confirm"?e.jsx(f,{variant:"danger",onClick:()=>S("final"),className:"flex-[2]",children:"Yes, Continue"}):e.jsx(f,{variant:"danger",onClick:me,className:"flex-[2]",children:"Delete Permanently"})]})]}),z&&l&&e.jsxs("div",{className:"fixed inset-0 z-[300] flex flex-col animate-in fade-in duration-200",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-900/50 backdrop-blur-sm",onClick:()=>O(!1)}),e.jsxs("div",{className:"relative m-6 lg:m-10 bg-white rounded-[2rem] border border-slate-200 shadow-2xl overflow-hidden flex flex-col min-h-[70vh]",children:[e.jsxs("div",{className:"h-14 px-6 flex items-center justify-between border-b border-slate-100 bg-white/95 backdrop-blur-md shrink-0",children:[e.jsx("div",{className:"text-[10px] font-black text-indigo-600 uppercase tracking-[0.3em]",children:"Report Preview"}),e.jsx("button",{onClick:()=>O(!1),className:"p-2 text-slate-400 hover:text-rose-500 transition-colors",children:e.jsx(T,{size:18})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar bg-slate-50/30 p-6 lg:p-10",children:e.jsx(te,{finding:l})})]})]}),e.jsx(V,{isOpen:ce,onClose:()=>{D(!1),F(null)},title:"Send Finding Report",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black text-indigo-600 uppercase tracking-widest px-1",children:"Recipient Email"}),e.jsx("input",{type:"email",value:I,onChange:a=>L(a.target.value),list:"recent-issue-emails",className:"w-full bg-slate-50 border border-slate-100 rounded-2xl px-5 py-4 text-sm font-bold outline-none focus:ring-4 focus:ring-indigo-500/10 focus:bg-white transition-all shadow-sm"}),e.jsx("datalist",{id:"recent-issue-emails",children:U.map(a=>e.jsx("option",{value:a},a))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black text-indigo-600 uppercase tracking-widest px-1",children:"Subject"}),e.jsx("input",{type:"text",value:P,onChange:a=>R(a.target.value),className:"w-full bg-slate-50 border border-slate-100 rounded-2xl px-5 py-4 text-sm font-bold outline-none focus:ring-4 focus:ring-indigo-500/10 focus:bg-white transition-all shadow-sm"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black text-indigo-600 uppercase tracking-widest px-1",children:"Format"}),e.jsxs("select",{value:q,onChange:a=>X(a.target.value),className:"w-full bg-slate-50 border border-slate-100 rounded-2xl px-5 py-4 text-sm font-bold text-slate-900 outline-none",children:[e.jsx("option",{value:"pdf",children:"PDF Attachment"}),e.jsx("option",{value:"html",children:"HTML Email"}),e.jsx("option",{value:"docx",children:"DOCX Attachment"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black text-indigo-600 uppercase tracking-widest px-1",children:"Message (optional)"}),e.jsx("textarea",{value:H,onChange:a=>B(a.target.value),className:"w-full min-h-[120px] bg-slate-50 border border-slate-100 rounded-2xl px-5 py-4 text-sm font-bold outline-none focus:ring-4 focus:ring-indigo-500/10 focus:bg-white transition-all shadow-sm"})]}),Q&&e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-rose-500",children:Q}),e.jsxs("div",{className:"flex gap-4 pt-2",children:[e.jsx(f,{variant:"secondary",onClick:()=>{D(!1),F(null)},className:"flex-1",children:"Cancel"}),e.jsx(f,{onClick:async()=>{if(!(!l||!t)){if(!I.trim()){F("Recipient email is required.");return}try{J(!0),F(null);const a=await je({projectId:t,issueId:l.id,to:I.trim(),subject:P.trim(),message:H.trim(),format:q});if(a!=null&&a.error){F(a.error),M(a.error);return}M("Finding report sent.","success");const c=Array.from(new Set([I.trim(),...U])).filter(Boolean).slice(0,8);Z(c),localStorage.setItem("vanguardRecentEmails",JSON.stringify(c)),D(!1),L(""),B("")}catch(a){console.error("Failed to send report email",a),F("Failed to send email. Check SMTP settings."),M("Failed to send email.")}finally{J(!1)}}},className:"flex-[2]",disabled:Y,children:Y?"Sending...":"Send Report"})]})]})})]})};export{ls as default};
