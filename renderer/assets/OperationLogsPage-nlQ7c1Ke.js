import{r as n,j as e,A as k,i as w,n as y}from"./index-B76BCRfw.js";import{f as M}from"./issueService-Jeyd4UeA.js";const g=10,E=r=>{const o=new Date(r);if(Number.isNaN(o.getTime()))return"Just now";const d=Date.now()-o.getTime(),i=Math.floor(d/6e4);if(i<1)return"Just now";if(i<60)return`${i} mins ago`;const c=Math.floor(i/60);return c<24?`${c} hours ago`:`${Math.floor(c/24)} days ago`},L=({activeProjectId:r,profile:o})=>{const[d,i]=n.useState([]),[c,x]=n.useState(!1),[m,h]=n.useState(null),[f,b]=n.useState(g),v=n.useRef(null);n.useEffect(()=>{let t=!0;return(async()=>{if(r){x(!0),h(null);try{const s=await M(r);if(!t)return;i(s||[])}catch(s){if(!t)return;i([]),h((s==null?void 0:s.message)||"Unable to load operation logs."),y((s==null?void 0:s.message)||"Unable to load operation logs.")}finally{t&&x(!1)}}})(),()=>{t=!1}},[r]);const j=(o==null?void 0:o.username)||"Analyst",l=n.useMemo(()=>[...d].sort((a,s)=>new Date(s.updatedAt).getTime()-new Date(a.updatedAt).getTime()).map(a=>({id:a.id,user:j,action:a.isFixed||a.state==="Fixed"?"verified fix":"updated finding",target:a.title||"Untitled finding",timestamp:E(a.updatedAt)})),[d,j]),N=n.useMemo(()=>l.slice(0,f),[l,f]),u=f<l.length;return n.useEffect(()=>{b(g)},[l.length,r]),n.useEffect(()=>{if(!u)return;const t=v.current;if(!t)return;const a=new IntersectionObserver(s=>{s.some(p=>p.isIntersecting)&&b(p=>Math.min(p+g,l.length))},{rootMargin:"200px"});return a.observe(t),()=>a.disconnect()},[u,l.length]),e.jsxs("div",{className:"flex flex-col gap-6 sm:gap-8 animate-in fade-in slide-in-from-bottom-4 duration-700 h-[calc(100vh-220px)] min-h-[520px]",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-end justify-between gap-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-3xl sm:text-4xl font-black text-slate-800 tracking-tight",children:"Operation Logs"}),e.jsx("p",{className:"text-slate-500 font-medium text-sm",children:"Real-time activity feed for the active project vault."})]})}),m&&e.jsx("div",{className:"bg-rose-50/80 border border-rose-100 text-rose-500 text-[10px] font-black uppercase tracking-[0.3em] px-6 py-3 rounded-2xl",children:m}),c&&!m&&e.jsx("div",{className:"bg-slate-50/80 border border-slate-100 text-slate-500 text-[10px] font-black uppercase tracking-[0.3em] px-6 py-3 rounded-2xl",children:"Syncing operation feed..."}),e.jsxs("div",{className:"flex-1 min-h-0 bg-white rounded-[3rem] shadow-sm border border-slate-200 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 sm:p-8 border-b border-slate-100 flex items-center justify-between bg-slate-50/60",children:[e.jsx("h3",{className:"font-black text-slate-800 tracking-tight text-sm",children:"Operation Logs"}),e.jsxs("div",{className:"flex items-center gap-1 bg-indigo-50 text-indigo-600 px-2 py-1 rounded-full text-[8px] font-black uppercase tracking-widest",children:["Live Feed ",e.jsx(k,{size:10})]})]}),e.jsxs("div",{className:"flex-1 min-h-0 divide-y divide-slate-100 overflow-y-auto custom-scrollbar no-scrollbar",children:[N.length?N.map(t=>e.jsxs("div",{className:"p-5 sm:p-6 flex items-start gap-4 hover:bg-slate-50/60 transition-all cursor-pointer group",children:[e.jsx("div",{className:"w-8 h-8 rounded-xl bg-slate-100 flex items-center justify-center text-slate-500 group-hover:bg-indigo-600 group-hover:text-white transition-all shrink-0",children:e.jsx(w,{size:14})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("p",{className:"text-xs text-slate-700 font-medium leading-snug",children:[e.jsx("span",{className:"font-black text-slate-900",children:t.user})," ",t.action]}),e.jsx("p",{className:"text-[10px] font-bold text-indigo-600 truncate mt-0.5 uppercase tracking-widest",children:t.target}),e.jsx("p",{className:"text-[8px] text-slate-400 font-black mt-1 uppercase tracking-[0.2em]",children:t.timestamp})]})]},t.id)):e.jsx("div",{className:"p-8 text-center text-[9px] font-black uppercase tracking-[0.3em] text-slate-400",children:"No recent activity"}),u&&e.jsx("div",{ref:v,className:"py-4 text-center text-[9px] font-black uppercase tracking-[0.3em] text-slate-400",children:"Loading moreâ€¦"})]})]})]})};export{L as default};
